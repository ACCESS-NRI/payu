#!/usr/bin/env python

import argparse
import os
import payu
import sys

# TODO: How to move this to payu.py?
model_index = {'mom': payu.Mom,
               'mom4': payu.mom4,
               'mitgcm': payu.mitgcm,
               'gold': payu.gold}


def payu_run(model_name):

    model = model_index[model_name]
    expt = model()
    expt.modules.append('ipm')

    expt.setup()
    expt.run('-mca mpi_preconnect_mpi 1')
    expt.archive()

    if expt.n_runs > 0:
        expt.resubmit()


if __name__ == '__main__':

    model_name = os.environ.get('model')
    payu_run(model_name)
